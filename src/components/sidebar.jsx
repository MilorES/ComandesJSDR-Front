import { Link, useLocation } from "react-router-dom";
import { useState } from "react";
import logo from "../assets/logo3.png";
import { useAuth } from "../context/AuthContext";
import AboutModal from "./AboutModal";

const GestioProductesIcon = () => (
  <svg className="w-6 h-6 inline-block mr-2" viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">
    <path fill="#f9a825" d="M823.556 1695.81h.16a453.847 453.847 0 0 0 82.347-7.494l26.198 56.761c16.295 35.553 58.494 51.107 93.984 34.75l72.08-33.143c35.486-16.362 51.044-58.556 34.749-94.047l-26.266-56.82c34.39-27.87 64.02-60.148 88.441-95.827l58.744 21.776c35.486 13.166 77.92-6.39 91.083-41.882l27.425-74.485c6.583-17.775 5.843-37.017-2.093-54.182-7.935-17.222-22.136-30.32-39.784-36.776l-58.855-21.774a446.164 446.164 0 0 0-4.993-130.211l56.886-26.137c35.49-16.36 51.062-58.541 34.7-93.965l-33.156-72.142c-16.357-35.428-58.556-51.062-94.042-34.7l-56.824 26.197a449.222 449.222 0 0 0-95.76-88.377l21.713-58.788c6.578-17.777 5.837-37.035-2.098-54.244-7.868-17.16-22.07-30.26-39.784-36.844l-74.427-27.488c-17.777-6.52-37.017-5.793-54.177 2.08-17.228 7.935-30.327 22.088-36.844 39.865l-21.774 58.854a444.996 444.996 0 0 0-46.62-2.62l-1.013-.002V964.67l.852.009c108.722.392 208.178 64.25 253.686 163.028 64.63 140.363 3.066 307.149-137.281 371.797-37.032 17.076-76.404 25.735-116.935 25.757h-.159l-.163-.001v170.55z"/>
    <path fill="#ffb74d" d="m316.497 1175.57 58.856 21.695c-4.678 42.935-3.134 86.66 4.927 130.21l-56.838 26.137c-35.491 16.295-51.044 58.55-34.687 94.104l33.143 72.016c16.375 35.49 58.493 51.107 93.984 34.75l56.882-26.26c27.872 34.432 60.162 64.018 95.715 88.436l-21.713 58.81c-13.479 36.65 5.289 77.479 41.945 91.02l74.408 27.55c35.49 13.037 77.94-6.516 91.038-41.943l21.696-58.868a450.573 450.573 0 0 0 47.703 2.58v-170.55c-109.05-.06-208.982-64-254.59-162.973-64.585-140.472-3.02-307.213 137.28-371.906 37.205-17.035 76.57-25.711 117.157-25.711l.154.001V794.143c-27.423-.039-55.045 2.448-82.56 7.532l-26.137-56.82c-16.375-35.49-58.555-51.112-94.045-34.75l-72.017 33.206c-35.553 16.357-51.058 58.493-34.683 94.041l26.132 56.825c-34.384 27.868-64.032 60.1-88.388 95.71l-58.792-21.77c-17.776-6.52-37.03-5.78-54.24 2.138-17.166 7.935-30.264 22.092-36.78 39.805l-27.493 74.473c-13.541 36.592 5.293 77.496 41.944 91.038z"/>

    <path fill="#e53935" d="M1470.86 863.143h.089c15.176.01 30.446-1.36 45.68-4.157l14.532 31.487c9.04 19.722 32.448 28.35 52.135 19.275l39.984-18.385c19.685-9.076 28.316-32.481 19.276-52.17l-14.57-31.518c19.077-15.46 35.513-33.366 49.06-53.158l32.587 12.08c19.684 7.303 43.224-3.545 50.525-23.233l15.214-41.319c3.652-9.86 3.241-20.533-1.16-30.055-4.403-9.554-12.28-16.82-22.071-20.4l-32.647-12.08a247.51 247.51 0 0 0-2.77-72.23l31.556-14.499c19.686-9.076 28.325-32.474 19.248-52.124l-18.392-40.018c-9.073-19.654-32.483-28.326-52.167-19.25l-31.521 14.532a249.179 249.179 0 0 0-53.121-49.024l12.044-32.611c3.65-9.861 3.24-20.544-1.163-30.091-4.364-9.519-12.242-16.786-22.069-20.438l-41.286-15.248c-9.861-3.617-20.534-3.214-30.054 1.154-9.556 4.402-16.822 12.253-20.437 22.114l-12.08 32.648a246.786 246.786 0 0 0-25.86-1.453l-.562-.002v94.594l.473.005c60.31.217 115.48 35.641 140.725 90.435 35.85 77.863 1.7 170.382-76.153 206.244-20.542 9.472-42.383 14.276-64.866 14.287h-.178v94.608z"/>
    <path fill="#ef5350" d="m1189.58 574.556 32.65 12.034c-2.596 23.818-1.74 48.074 2.732 72.232l-31.53 14.498c-19.687 9.039-28.314 32.48-19.24 52.202l18.384 39.949c9.084 19.686 32.448 28.35 52.135 19.277l31.554-14.568a251.123 251.123 0 0 0 53.096 49.057l-12.045 32.623c-7.477 20.332 2.934 42.98 23.267 50.491l41.276 15.284c19.688 7.232 43.235-3.616 50.501-23.268l12.035-32.655c8.77.943 17.6 1.422 26.462 1.432v-94.608c-60.492-.034-115.926-35.503-141.227-90.405-35.826-77.924-1.676-170.418 76.152-206.304 20.639-9.45 42.475-14.263 64.99-14.263h.085V362.97a250.045 250.045 0 0 0-45.798 4.179l-14.498-31.52c-9.084-19.687-32.482-28.352-52.17-19.276l-39.948 18.42c-19.723 9.074-28.323 32.447-19.24 52.167l14.495 31.522c-19.073 15.458-35.519 33.34-49.03 53.092l-32.612-12.076c-9.862-3.617-20.543-3.206-30.09 1.186-9.52 4.4-16.787 12.255-20.402 22.08l-15.25 41.312c-7.513 20.299 2.935 42.989 23.266 50.5z"/>
    
    <path fill="#26a69a" d="M893.803 632.732h.06c10.43.007 20.923-.934 31.392-2.857l9.987 21.638c6.211 13.553 22.298 19.482 35.828 13.247l27.477-12.634c13.527-6.238 19.459-22.322 13.246-35.851l-10.012-21.66a172.174 172.174 0 0 0 33.714-36.531l22.393 8.3c13.528 5.02 29.705-2.435 34.722-15.964l10.455-28.395c2.509-6.776 2.226-14.11-.798-20.654-3.025-6.566-8.44-11.56-15.167-14.02l-22.435-8.3a170.077 170.077 0 0 0-1.904-49.638l21.686-9.963c13.529-6.237 19.465-22.316 13.227-35.821l-12.639-27.5c-6.235-13.507-22.321-19.467-35.85-13.23l-21.66 9.988a171.25 171.25 0 0 0-36.505-33.69l8.277-22.411c2.507-6.776 2.225-14.118-.8-20.678-3-6.542-8.413-11.535-15.166-14.045l-28.372-10.479c-6.777-2.485-14.111-2.207-20.652.794-6.568 3.025-11.562 8.42-14.046 15.196l-8.3 22.436a169.604 169.604 0 0 0-17.773-1h-.385v65.006l.324.003c41.446.15 79.36 24.492 96.707 62.147 24.638 53.508 1.168 117.087-52.332 141.732-14.117 6.51-29.126 9.81-44.577 9.819h-.122v65.015z"/>
    <path fill="#4db6ac" d="m700.508 434.415 22.436 8.27c-1.782 16.367-1.194 33.034 1.88 49.637l-21.668 9.964c-13.53 6.211-19.459 22.32-13.224 35.872l12.636 27.454c6.242 13.53 22.297 19.482 35.826 13.246l21.684-10.01a172.6 172.6 0 0 0 36.488 33.712l-8.277 22.419c-5.138 13.971 2.016 29.536 15.99 34.698l28.364 10.503c13.53 4.969 29.712-2.485 34.705-15.99l8.27-22.441c6.028.648 12.095.978 18.186.984v-65.015c-41.572-.024-79.667-24.398-97.053-62.127-24.62-53.55-1.151-117.111 52.333-141.773 14.182-6.494 29.188-9.802 44.66-9.802h.06v-65.005a171.766 171.766 0 0 0-31.473 2.872l-9.964-21.662c-6.242-13.528-22.322-19.483-35.851-13.246l-27.452 12.658c-13.555 6.235-19.465 22.298-13.223 35.85l9.963 21.661c-13.108 10.624-24.41 22.911-33.695 36.486l-22.411-8.299c-6.777-2.486-14.117-2.204-20.678.815-6.543 3.025-11.537 8.422-14.02 15.174l-10.48 28.389c-5.163 13.95 2.017 29.543 15.988 34.705z"/>
  </svg>
);

const ProductesIcon = () => (
  <svg className="w-6 h-6 inline-block mr-2" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg">
    <path fill="#643513" d="m63.999 14.694 21.373 12.55 21.372 12.549-21.372 12.55-21.619 12.695-21.126-12.695-21.372-12.55 21.372-12.549 21.372-12.55z"/>
    <path fill="#926e43" d="M63.753 65.038v48.812L21.255 89.247V64.75L35.7 73.232l21.372 12.55 6.681-20.744z"/>
    <path fill="#a67e4f" d="m106.73 41.237.014-1.444-.413.242zm-42.977 23.8v48.813l42.5-24.6.246-24.641-14.69 8.626-21.376 12.547z"/>
    <path fill="#8d5122" d="M64 47.982V14.694l-21.372 12.55-21.372 12.549 21.371 12.55 6.889 4.046L64 47.982z"/>
    <path fill="#77411b" d="M64 14.694v33.288l14.398 8.357 27.853-16.546.08.243.413-.243-21.372-12.549L64 14.694z"/>
    
    <path fill="#c99e79" fillRule="evenodd" d="m57.072 85.782 6.941-20.87-42.498-25.245-7.187 21.016L35.7 73.232l21.372 12.55z"/>
    <path fill="#d9ac80" fillRule="evenodd" d="m21.256 39.793-8.341-.544L55.66 14.15l8.34.544-21.372 12.55-21.372 12.549z"/>
    <path fill="#d9ac80" fillRule="evenodd" d="m70.433 85.782-6.68-20.744 42.498-25.244 6.927 20.889-21.372 12.549-21.373 12.55zM106.744 39.793l8.341-.544L72.34 14.15l-8.34.544 21.372 12.55 21.372 12.549z"/>
  </svg>
);

const GestioUsuarisIcon = () => (
    <svg className="w-6 h-6 inline-block mr-2" viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">
      <path fill="#004d40" d="M1500.28 1436.64v-201.625c0-26.385-10.643-50.224-27.834-67.442-17.135-17.16-40.894-27.775-67.192-27.775H642.747c-26.297 0-50.056 10.615-67.192 27.775-17.19 17.218-27.833 41.057-27.833 67.442v224.177l-21.376 7.573c-31.337 11.1-58.117 31.58-76.847 58.038-18.134 25.617-28.792 57.07-28.792 91.268 0 87.522 70.975 158.628 158.628 158.628 43.74 0 83.402-17.784 112.127-46.507 28.717-28.719 46.502-68.372 46.502-112.121 0-34.09-10.686-65.49-28.852-91.113-18.842-26.575-45.681-47.11-76.99-58.193l-21.376-7.567V1203.014H992.393v256.178l-21.376 7.573c-31.337 11.1-58.118 31.58-76.848 58.038-18.133 25.617-28.792 57.07-28.792 91.268 0 87.522 71.002 158.628 158.617 158.628 43.8 0 83.449-17.767 112.148-46.466 28.719-28.719 46.481-68.388 46.481-112.162 0-34.198-10.658-65.65-28.792-91.268-18.73-26.459-45.511-46.938-76.848-58.038l-21.376-7.573v-256.177H1437.254v256.183l-21.376 7.567c-31.308 11.083-58.148 31.618-76.99 58.193-18.165 25.623-28.852 57.023-28.852 91.113 0 87.522 71.134 158.628 158.63 158.628 43.811 0 83.456-17.763 112.151-46.458 28.719-28.718 46.477-68.39 46.477-112.17 0-34.198-10.659-65.651-28.792-91.268-18.73-26.46-45.51-46.938-76.848-58.038l-21.375-7.573v-22.552z"/>
      <path fill="#26a69a" d="M1280.97 525.374c0 69.7-28.932 132.842-75.703 178.583a257.472 257.472 0 0 1-35.093 28.727c67.811 10.647 128.557 42.198 175.048 87.667 58.144 56.866 94.16 135.33 94.16 221.866v.242h-.117l.618 38.286.524 32.5H608.001v-70.786c0-86.58 36.07-165.144 94.29-222.075A322.069 322.069 0 0 1 877.2 732.595a257.158 257.158 0 0 1-34.956-28.63c-46.687-45.668-75.561-108.808-75.561-178.59 0-69.68 28.919-132.79 75.679-178.5 46.503-45.464 110.66-73.579 181.443-73.579 70.783 0 134.954 28.116 181.472 73.584 46.766 45.709 75.694 108.816 75.694 178.494z"/>
    </svg>
);

const DashboardIcon = () => (
    <svg className="w-6 h-6 inline-block mr-2" viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">
      <path fill="#039be5" d="M1080.36 840.181h200.534v935.823H1080.36z"/>
      <path fill="#ef5350" d="m701.575 840.181 200.534-38.251V1776H701.575z"/>
      <path fill="#f9a825" d="m322.791 1245.57 200.533-71.17V1776H322.791zm1136.359-605.922h200.534v1136.36H1459.15z"/>
      <path fill="#7cb342" d="m880.283 833.953 504.107 125.941 174.51-290.688 158.12 94.961 8.19-492.171-430.35 238.862 158.12 94.966-127.39 212.347-483.16-120.89-518.328 518.349-1.227 169.75z"/>
    </svg>
);

const GestioComandesIcon = () => (
    <svg className="w-6 h-6 inline-block mr-2" viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">
      <path fill="#00796b" d="M1614.92 1792.01H433.43c-65.202 0-118.285-53.104-118.285-118.306v-1299.4c0-65.203 53.084-118.306 118.285-118.306h1181.49c64.826 0 117.93 53.104 117.93 118.306v1299.4c0 65.203-53.104 118.306-117.93 118.306z"/>
      <path fill="#e0f2f1" d="M433.433 374.301V1673.7H1614.63l.29-1299.399z"/>
      <path fill="#f57f17" d="M610.517 517.03h118.306v117.991H610.517V517.03zm236.211 0h590.755v117.991H846.728V517.03zM846.728 815.685h590.755v117.991H846.728V815.685zm-236.211 0h118.306v117.991H610.517V815.685zM610.517 1114.34h118.306v117.992H610.517V1114.34zm236.211 0h590.755v117.992H846.728V1114.34zM610.517 1412.99h118.306v117.992H610.517V1412.99zm236.211 0h590.755v117.992H846.728V1412.99z"/>
    </svg>
);

export default function Sidebar({ isOpen, onClose }) {
  const location = useLocation();
  const { user } = useAuth();
  const [showAbout, setShowAbout] = useState(false);

  return (
    <>
      {isOpen && (
        <div
          className="fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden"
          onClick={onClose}
          aria-hidden="true"
        />
      )}

      <div
        className={`w-64 bg-gradient-to-b bg-slate-800 text-white flex flex-col transition-transform duration-300 ${
          isOpen ? "translate-x-0" : "-translate-x-full md:translate-x-0"
        } fixed md:relative h-full z-50`}
      >
        <div className="p-4 border-b border-slate-600 flex items-center justify-between">
          <div className="flex-1 flex justify-center">
            <img src={logo} alt="logotip" className="h-22 md:h-26 w-auto" />
          </div>
          <button
            className="md:hidden text-white hover:bg-blue-700 p-2 rounded transition ml-2"
            onClick={onClose}
            aria-label="Cerrar menú"
          >
            <svg
              className="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>

        <nav className="flex-1 py-6">
          {user?.role === "Administrator" && (
            <>
              <Link
                to="/admin"
                className={`block px-6 py-3 text-lg font-medium transition-colors hover:bg-slate-500 ${
                  location.pathname === "/admin"
                    ? "bg-slate-600 border-l-4 border-yellow-400"
                    : ""
                }`}
                onClick={onClose}
              >
                <GestioProductesIcon />
                Gestió Productes
              </Link>

              <Link
                to="/gestio-usuaris"
                className={`block px-6 py-3 text-lg font-medium transition-colors hover:bg-slate-500 ${
                  location.pathname === "/gestio-usuaris"
                    ? "bg-slate-600 border-l-4 border-yellow-400"
                    : ""
                }`}
                onClick={onClose}
              >
                <GestioUsuarisIcon />
                Gestió Usuaris
              </Link>
            </>
          )}

          <Link
            to="/dashboard"
            className={`block px-6 py-3 text-lg font-medium transition-colors hover:bg-slate-500 ${
              location.pathname === "/dashboard"
                ? "bg-slate-600 border-l-4 border-white"
                : ""
            }`}
            onClick={onClose}
          >
            <DashboardIcon />
            Dashboard
          </Link>

          <Link
            to="/productes"
            className={`block px-6 py-3 text-lg font-medium transition-colors hover:bg-slate-500 ${
              location.pathname === "/productes"
                ? "bg-slate-600 border-l-4 border-white"
                : ""
            }`}
            onClick={onClose}
          >
            <ProductesIcon />
            Productes
          </Link>

          <Link
            to="/gestio-comandes"
            className={`block px-6 py-3 text-lg font-medium transition-colors hover:bg-slate-500 ${
              location.pathname === "/gestio-comandes"
                ? "bg-slate-600 border-l-4 border-white"
                : ""
            }`}
            onClick={onClose}
          >
            <GestioComandesIcon />
            Gestió Comandes
          </Link>
        </nav>

        {/* Peu */}
        <div className="p-4 border-t border-blue-700 text-sm text-blue-200">
          <button
            onClick={() => setShowAbout(true)}
            className="text-left hover:text-white transition-colors w-full"
          >
            <div>© 2025 ComandesJSDR v{__APP_VERSION__}</div>
          </button>
        </div>
      </div>

      <AboutModal isOpen={showAbout} onClose={() => setShowAbout(false)} />
    </>
  );
}